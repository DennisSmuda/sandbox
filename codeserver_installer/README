# encoding: UTF8
# author: Santa Zhang (santa1987@gmail.com)

代码服务器说明文档
================


用途：
=====
该软件包用于安装一个代码服务器，包括了对 git 以及 svn 的支持，此外还有一个 Redmine 网站，用于项目管理以及错误追踪。


适用系统：
=========
Ubuntu 9.04 或更高版本系统。


安装要求：
=========
能够使用 apt-get 安装软件包。


使用方法：
=========
运行 ./install.sh 进行自动安装。该脚本会自动安装需要的软件，并进行基本的配置。等安装过程完毕之后，到安装目录下，运行 rake start 启动代码服务器。
建议修改 rc.local 使得每次开机时自动启动代码服务进程。运行 rake stop 则关闭代码服务器。


关于自动备份功能：
================
运行 rake backup 可以对重要的数据（Redmine 的数据库，以及所有的代码仓库）进行备份。备份的数据保存在 backup 目录下，文件名中包含了时间戳。
该服务器还具有自动备份的功能，并且可以将备份的数据发送到远端 FTP 上，使得备份更加安全。请修改 backup.ini 文件（已经提供了示例的 backup.ini.example 文件）以便于进行自动备份。
backup.ini 中利用 # 进行行注释。interval 项目指定了自动备份的时间间隔（单位：分钟）。每一个远端的 FTP 对应一个用 [ 和 ] 标示的配置段落，每个段落中必须包含这些项目：
+ host: FTP 的地址
+ port: FTP 的端口号
+ user: 用于备份的用户名
+ passwd: 用户密码
+ dir: 备份的数据保存的目录
对于 backup.ini 的修改需要重启代码服务器（rake stop && rake start）才能启用。


关于 svn：
=========
svn 代码的仓库位置在安装目录下的 svn-repo 文件夹中。使用这样的地址访问 svn 代码仓库： svn://<代码服务器地址>/<svn 代码仓库名>，eg: svn://10.0.1.254/svn-sandbox。
+ 添加新的 svn 代码仓库： rake svnnew
  注意：请使用全小写方式命名。
+ 向 svn 代码仓库中添加用户：　rake svnadduser
+ 从 svn 代码仓库中删除用户（尽量避免使用！）: rake svndeluser


关于 git：
=========
git 代码的仓库位置在安装目录下的 git-repo 文件夹中。本代码服务器利用 gitosis 提供对 git 的支持。使用这样的地址访问 git 代码仓库： git@<代码服务器地址>:<git 仓库名>.git，eg: git@10.0.1.254:git-sandbox.git。
+ 添加新的 git 代码仓库： rake gitnew
  注意：请使用全小写方式命名。
+ 向 git 代码仓库中添加用户： rake gitadduser
  注意：需要提供用户的公钥文件。此外，建议使用类似于 somebody@somewhere 的用户命名方式。
+ 从 git 代码仓库中删除用户（尽量避免使用！）: rake gitdeluser


关于 Redmine：
=============
Redmine 是一个用于项目管理以及错误追踪的网页工具，可以辅助项目开发。在安装完成时，默认的管理员用户名是 "admin"，密码是 "admin" （不包含引号）。
使用 rake svnnew 或者 rake gitnew 不会在 Redmine 中添加对应的项目，该工作需要手动完成。推荐的工作流程：用户在 Redmine 上注册 -> 管理员建立代码仓库 -> 管理员建立 Redmine 项目。
此外，管理员需要配置好 Redmine 中代码库的位置，建议直接使用文件系统绝对地址。
更多信息，参考 Redmine 官方网站：http://www.redmine.org


所有 rake 任务汇总（用 rake -T 查看）：
====================================
rake backup           立即备份数据到 backup 文件夹。
rake backup:remote    立即备份数据到 backup 文件夹，并且发送到远端 FTP 上。
rake gitadduser       向 git 代码仓库中添加用户。
rake gitdeluser       从 git 代码仓库中删除用户。（小心使用！）
rake gitnew           添加新的 git 代码仓库。
rake start            启动代码服务进程。
rake stop             关闭代码服务进程。
rake svnadduser       向 svn 代码仓库中添加用户。
rake svndeluser       从 svn 代码仓库中删除用户。（小心使用！）
rake svnnew           添加新的 svn 代码仓库。



====================================================================================================

README document for codeserver_installer


Intention:
==========
Install & configure a dedicated machine as code repository server. Supports SVN & GIT. Redmine website is included for project management & bug tracking.


System requirements:
====================
+ Ubuntu 9.04 or above
+ Could use "apt-get" to install software packages (network available)


How to install:
===============
Just type: "./install.sh". This magic script will download all required packages and install them.
When everything is done, go to the install path and type "rake start" to boot the services.
It is advised to boot the services on system start, by editing rc.local file.


About automatic backup:
=======================
You could run "rake backup" to backup all important data (Redmine databse, and all the code repositories). The backups are saved to "backup" folder, with timestamps
in filenames. This software also support "automatical backup", and could push backup files to remote FTP servers, making your code even safer. Please modify the "backup.ini"
file to enable this feature. A "backup.ini.example" file is provided as demo.

In "backup.ini", comments starts with "#" and goes to end-of-line.

The "interval" item determines the automatic backup interval, its unit is in minutes. Every remote FTP is denoted by a configuration section, and the following items are required:
+ host: Host address of the FTP
+ port: Port of the FTP
+ user: The username used for backup
+ passwd: The password
+ dir: Where will all the backup data be saved.

When you edited "backup.ini", you must restart the services to make it take effect. Restart by "rake stop && rake start".


About SVN support:
==================
SVN repositories are stored in "svn-repo" folder. Access your SVN repository by this address: svn://<server address>/<svn repository name>, eg: svn://10.0.1.254/svn-sandbox.
+ Add new SVN repository: rake svnnew
  NOTE: please use only lowercase characters for repository name.
+ Add a new user to SVN repository: rake svnadduser
+ Remove a user from SVN repository (use with caution!): rake svndeluser


About GIT support:
==================
GIT repositories are stored in "git-repo" folder. We use gitosis to support GIT repositories.
Access your GIT repository by this address: git@<server address>:<git repository name>.git, eg: git@10.0.1.254:git-sandbox.git
+ Add new GIT repository: rake gitnew
  NOTE: please use only lowercase characters for repository name.
+ Add a new user to GIT repository: rake gitadduser
+ Remove a user from GIT repository (use with caution!): rake gitdeluser


About Redmine:
==============
Redmine is a web site tool with project management and bug tracking utilities. When setup is done, the default administrator's user name is "admin", password is "admin" (quote not included).
Project will not be added in Redmine by using "rake svnnew" or "rake gitnew", you should do that by hand.

An advised working process: user registrate on Redmine -> administrator creates code repository -> administrator creates Redmine project.

Administrator should configure project repository path in Redmine. It is advised to use system path.

For more information, see Redmine official site: http://www.redmine.org


All rake tasks (list with "rake -T"):
=====================================
rake backup           Backup data into "backup" folder.
rake backup:remote    Backup data into "backup" folder, and send to remote FTP sites.
rake gitadduser       Add user to GIT repository.
rake gitdeluser       Remove user from GIT repository. (use with caution!)
rake gitnew           Create new GIT repository.
rake start            Start service.
rake stop             Stop service.
rake svnadduser       Add user to SVN repository.
rake svndeluser       Remove user from SVn repository. (use with caution!)
rake svnnew           Create new SVN repository.

